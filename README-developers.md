# The DACE api.

This is the **developers**' documentation.

## Install ( from the requirements )

This section describes how to install properly the _dace-query_ package and all the required
modules in order to **debug** it, **add** in or **code** **modules**.

```shell
# This will install the package locally
pip install .
```

If you want to install it in editable mode, to be able to edit and test on the fly, run:

```shell
# This will install the package in editable mode
pip install -e .
```

## Test validation

This section describes how to run tests properly.  
There are two type of test :

* **pytest :** python test

```shell
# This will run python test which are stored under the /tests folder
pytest
```

* **doctest :** docstring test

```shell
# This will execute docstring tests and the result output will be store under /docs/build/doctest 
cd docs && make doctest
```

---
**Note :**

In order to run the tests correctly, it is necessary to have the following two files correctly defined under
the [`tests`](./tests) folder :

* _config.ini_ ( where endpoints are the developments endpoints )
* _dev.dacerc_ ( where the api key is that of a particular privileged user )

---

## Package generation

This section describes how to generate properly the package.

**Important steps to take before generating & uploading the package**

1. Update the package version ( **project.version** ) in the [`pyproject.toml`](./pyproject.toml) file.
2. Edit the [`changelogs.rst`](./docs/source/changelogs.rst) file indicating all the changes that were made since the last version
3. Commit and push every change & tag the commit ( using **git** )

```shell
# Delete any existing builds
rm -rf dist/*

# Build the package
# This will create a tar.gz and .whl package under /dist
python -m build
python -m twine check dist/*

# .. Publish the package on https://test.pypi.org (in case of development release)
# TEST_PYPI_TOKEN is the token generated by https://test.pypi.org
python -m twine upload --repository-url https://test.pypi.org/legacy/ dist/* -u __token__ -p $TEST_PYPI_TOKEN

# .. Publish the package on https://pypi.org
# PYPI_TOKEN is the token generated by https://pypi.org
python -m twine upload dist/* -u __token__ -p $PYPI_TOKEN
```

## Documentation generation ( locally )

This section describes how to generate the documentation.

```shell
# This will generate the html documentation ( under docs/build/html/ ) based on the docstring from the dace module. 
cd docs
make html
```

and locally clean the documentation is done using :

```shell
# This will remove anything under docs/build/
cd docs
make clean
```

---
**Note :**

In case new modules need to be added in the documentation, _dace.rst_ must be regenerated.

1. `rm dace.rst`
2. `cd docs && sphinx-apidoc -o source ../dace_query`

---

## Documentation publication

This section describes how to compile and publish the dace-api documentation using https://readthedocs.org

1. Commit the changes
2. Build and publish the package
3. Log in to https://readthedocs.org
4. Add the project ( if not already done )
5. Compile latest version of documentation
