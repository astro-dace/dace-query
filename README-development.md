# The DACE api.

This is the **development** documentation.

## Install ( from the requirements )

This section describes how to install properly ( using **poetry** ) the dace api and required modules in order to
**debug** it, **add** in or **code** **modules**.

```shell
# This will create a poetry environment and install in the required modules 
poetry install
```

## Test validation

This section describes how to run tests properly.   
There are two type of test :

* pytest : python test

```shell
# This will run python test which are stored under the /tests folder
poetry run pytest
```

* doctest : docstring test

```shell
# This will execute docstring tests and the result output will be store under /docs/build/doctest 
cd docs && make doctest
```

## Package generation

This section describes to generate properly ( using **poetry** ) the package.

```shell
# This will create a tar.gz and .whl package under /dist
# TEST_PYPI_TOKEN is the token generated by https://test.pypi.org
poetry build
poetry run twine check dist/*.tar.gz
poetry source add pypi-test https://test.pypi.org/legacy/
poetry config pypi-token.pypi-test $TEST_PYPI_TOKEN
poetry publish --repository pypi-test

```

## Documentation initialization

This section describe how to initialize (for the 1st time) the documentation folder

```shell
# This will generate the docs folder containing init files
sphinx-quickstart docs/


```

## Documentation generation ( locally )

This section describes how to generate the documentation.

```shell
# This will generate the html documentation ( under docs/build/html/ ) based on the docstring from the dace module. 
cd docs && make html
```

and cleaning documentation can be done using :

```shell
# This will remove anything under docs/build/
cd docs && make clean
```

---
**Note :**

In case new modules need to be added in the documentation, _dace.rst_ must be regenerated.

1. `rm dace.rst`
2. `cd docs && sphinx-apidoc -o source ../dace_query`

---

## Documentation publication

This section describes how to compile and publish the dace-api documentation using https://readthedocs.io.

1. Commit the changes
2. Build and publish the package
3. Log in to readthedocs.io
4. Add the project using http credentials if not already done
5. Compile latest version of documentation

## Update the package version

---
**Important note :**

Only change the pyproject.toml tool.poetry.version value and then run

```shell
poetry lock
```

---
